Pasos para que el servidor funcione:

1. Crear un entorno virtual:
    # python3 -m venv virtual
2. Activarlo
    # source virtual/bin/activate
3. Instalar las dependencias
    # pip install -r requirements.txt
4. Instalamos docker
    # sudo apt-get install docker.io
5. Instalamos docker-compose
    # sudo apt-get install docker-compose
6. Establecemos que el usuario actual puede usar docker
    # sudo usermod -aG docker $USER (Se debe cerrar la sesión para que los cambios surtan efecto)
7. Instalamos la iptables
    # sudo apt-get install iptables (también se tienen que poner en el fichero sudoers para que no pida contraseña)
8. Los scripts iptables.sh y createUserVPN.sh deben tener los permisos correctos
    # chmod +x iptables.sh
    # chmod +x createUserVPN.sh
    8.1 Además de eso ejecutar dicho script con permisos sudo pero sin solicitar contraseña por ello se debe editar el archivo /etc/sudoers
    # nano /etc/sudoers
    8.2 Agregar la siguiente línea al final del archivo
    # username ALL=(ALL) NOPASSWD: /ruta/al/script/createUserVPN.sh /ruta/al/script/iptables.sh /usr/sbin/iptables 
9. Establecer y crear la VPN
    (Pendiente de hacer)
###############################
#!/bin/bash
# Script en sh que ejecutará todo para tener el servidor funcionando y listo
# La ejecución del programa sera: ./setup.sh <nombre_usuario>
# Se debe ejecutar con permisos de superusuario
if [ "$EUID" -ne 0 ]
  then echo "Por favor, ejecutar como superusuario"
  exit
fi
# Comprobación de prametros que sea solo 1
if [ "$#" -ne 1 ]
  then echo "Por favor, introduzca un solo parámetro"
  exit
fi
# Comprobamos que el parámetro sea el nombre de usuairo y que exista
if id "$1" &>/dev/null; then
    echo "El usuario $1 existe"
else
    echo "El usuario $1 no existe"
    exit
fi

# Instalamos las dependencias
apt-get update -y && apt-get upgrade -y && apt-get install -y python3-pip python3-dev libffi-dev libssl-dev python3-venv
# Creamos el entorno virtual
python3 -m venv virtual && source virtual/bin/activate && pip install -r requirements.txt && apt-get install -y docker.io docker-compose iptables
# Establecemos que el usuario actual puede usar docker
usermod -aG docker $USER 
# Los scripts iptables.sh y createUserVPN.sh deben tener los permisos correctos
chmod +x iptables.sh && chmod +x createUserVPN.sh 

# Creamos el servidor VPN y establecemos todo

# PENDIENTE DE HACER

# Además de eso ejecutar dicho script con permisos sudo pero sin solicitar contraseña por ello se debe editar el archivo /etc/sudoers
    # Compruebo si el usuario tiene algún permiso el el archivo /etc/sudoers y si tiene, quitarlos y poner los nuevos, 
    # si no tiene, poner los nuevos
# Obtener la ruta del script actual (utilizando PWD)
script_path=$(pwd)

# Construir el patrón con la ruta actual
pattern="$script_path/createUserVPN.sh $script_path/iptables.sh /usr/sbin/iptables"

# Que empiece por el nombre de usuario
if grep -q "^$1 ALL" /etc/sudoers; then
    sed -i "/$1 ALL/d" /etc/sudoers
fi
echo "$1 ALL=ALL=(ALL:ALL) NOPASSWD: $pattern" >> /etc/sudoers # Añado la linea al final del archivo

###############################
Documentado por: Marco Sevilla Martin
Fecha: 10/12/2020
Hecho en el servidor:
----------
Pendiente de hacer:
Instalar el servidor VPN para que funcione correctamente el levantar la maquina y detenerla
Instalar gunicorn para que corra en el puerto 8000
Instalar el servidor web nginx para que funcione correctamente y poner el certificado SSL con certbot
----------
Instalado:
-> net-tools
# apt-get install net-tools -y
-> nginx
# apt-get install nginx -y
-> python3-pip
# apt install python3 python3-pip -y
-> python3-venv
# apt install python3-venv -y
-> Instalo sqlite3
# apt-get install sqlite3 -y
-> Instalo docker (se ha instalado docker.io)
# apt-get install docker.io -y && apt-get install docker -y
-> Instalo scrub
# apt-get install scrub -y
-> Instalo unzip
# apt-get install unzip -y
-> Instalo las iptables
# apt-get install iptables -y
-> Instalo lsof
# apt-get install lsof -y
-> Instalo systemctl
# apt-get install systemd -y
-> Instalado man
# apt-get install man -y
-> Instalado el openvpn: OpenVPN 2.5.9

Modificado:
-> Fichero .bashrc configuraciones como:
# alias ll='ls -al'
# Funcion "tfg" y "rmk"
# export PATH=$PATH:/usr/sbin
-> Añado al path de root la ruta /usr/sbin (ANTES DE TODO)
# export PATH=$PATH:/usr/sbin 

Hecho:
-> Crear el entorno virtual
# python3 -m venv virtual
-> Añadir el usuario tfg al grupo sudo
# sudo usermod -aG sudo tfg
-> Instalar las dependencias
# source /home/tfg/TFG/virtual/bin/activate && sudo pip install -r requirements.txt
