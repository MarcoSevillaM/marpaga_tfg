{% extends 'personal/basic_profile.html' %}
{% load static %}
{% block sidebar %}
{% endblock sidebar %}
{% block content %}
<div class="content open">
  <!-- Navbar Start -->
  <nav
      class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0"
    >
    <a href="{% url 'personal' %}" class="navbar-brand mx-4 mb-3 d-flex align-items-center">
      <img src='{% static "assets/img/logo.jpg" %}' alt="Foto" class="rounded-icon me-2" width="32" height="32">
      <h3 class="text-primary m-0">MARPAGA</h3>
    </a>
      <a href="/" class="navbar-brand d-flex d-lg-none me-4">
        <img src='{% static "assets/img/logo.jpg" %}' alt="Foto" class="rounded-icon me-2" width="32" height="32">
      </a>

      </a>
      <div class="navbar-nav align-items-center ms-auto">
        <div>
          <a href="{% url 'maquinas' %}">
            <button class="btn btn-primary m-2">
              <span class="d-none d-lg-inline-flex">Maquinas</span>
            </button>
          </a>
        </div>
        <div class="nav-item dropdown">
          <a
            href="#"
            class="nav-link dropdown-toggle"
            data-bs-toggle="dropdown"
          >
            <img
              class="rounded-circle me-lg-2"
              {% if request.user.jugador.foto_perfil %}
                  src="{{ request.user.jugador.foto_perfil.url }}"
                {% else %}
                  src="{% static 'assets/img/anonimo.jpg' %}" 
                {% endif %}
              alt=""
              style="width: 40px; height: 40px"
            />
            <span class="d-none d-lg-inline-flex">{{ request.user }}</span>
          </a>
          <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0" >
            <a href="{% url 'profile' %}" class="dropdown-item">Perfil</a>
            <a href="{% url 'descargar_archivo' %}" class="dropdown-item" download="{{request.user}}.ovpn">Descargar VPN</a>
            <a href="#" class="dropdown-item">Ajustes</a>
            <a href="{% url 'logout_vista' %}" class="dropdown-item"> Cerrar Sesion</a>
          </div>
        </div>
      </div>
  </nav>
  <!-- Navbar End -->
    <div class="container rounded bg-secondary mt-5 mb-5">
        <div class="row">
            <div class="col-md-3 border-right">
                <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                    <button type="button" class="btn btn-primary btn-transparent border-0 btn-no-outline" data-toggle="modal" data-target="#exampleModal">
                        {% if request.user.jugador.foto_perfil %}
                            <img class="rounded-circle mt-5" width="150px" src="{{ request.user.jugador.foto_perfil.url }}">
                        {% else %}
                            <img class="rounded-circle mt-5" width="150px" src="{% static 'assets/img/anonimo.jpg' %}">
                        {% endif %}
                    </button>
                    <span class="font-weight-bold">{{ request.user }}</span>
                    <span class="text-danger">{{ request.user.email|default:"No tiene ningún correo asociado eres administrador" }}</span>
                    <span> </span>
                    {% if messages %}
                      <div class="bg-secondary rounded h-100 p-4">
                      {% for message in messages %}
                      <!-- Si el mensaje es de exito usar class="alert alert-success" role="alert" -->
                      {% if message.tags == 'success' %}
                          <div class="alert alert-success alert-dismissible fade show" role="alert">
                          {{ message }}
                      </div>
                      <!-- Si el mensaje es de informacion usar class="alert alert-info" role="alert" -->
                      {% elif message.tags == 'info' %}
                          <div class="alert alert-info alert-dismissible fade show" role="alert">
                          {{ message }}
                      </div>
                      {% endif %}
                      {% endfor %}
                      </div>
                  {% endif %}
                    <!-- Modal para cambiar la foto de perfil -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="exampleModalLabel">Foto de perfil</h5>
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                              </button>
                            </div>
                            <div class="modal-body">
                                <form id="formFotoPerfil" method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    {{ formImage.as_p }}
                                    <button class="btn btn-primary profile-button" type="submit" name="{{ formImage.submit_button.name }}" value="{{ formImage.submit_button.initial }}">Guardar cambios</button>
                                </form>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-5 border-right">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4 class="text-right">Hola {{ request.user.first_name|default:request.user.username}}</h4>
                      </div>
                      <form method="post">
                        {% csrf_token %}
                        <div class="row mt-3">
                          <div class="col-md-12"><label class="labels">Nombre de usuario</label><input type="text" class="form-control" placeholder="first name" value='{{ request.user.username }}' readonly></div>
                        </div>
                        <div class="row mt-2">
                          <div class="col-md-6"><label class="labels">Nombre</label><input type="text" class="form-control" value="{{ request.user.first_name}}" name="nombre" placeholder="Nombre completo"></div>
                          <div class="col-md-6"><label class="labels">Apellidos</label><input type="text" class="form-control" placeholder="Apellidos" name="apellidos" value="{{ request.user.last_name}}"></div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-12"><label class="labels">Correo electronico</label><input type="email" class="form-control" name="email" placeholder="correo electrónico" value="{{ request.user.email}}" readonly></div>
                        </div>
                        <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="submit">Actualizar Datos</button></div>
                      </form>
                </div>
            </div>
            <div class="col-md-4">
                <div class="p-3 py-5">
                    <div class="d-flex justify-content-between align-items-center experience"><h3 class="text-decoration-underline"><span>Modificar contraseña</span></h3></div><br>
                    <form method="post">
                      {% csrf_token %}
                      <div class="form-group">
                          <label for="old_password">Contraseña antigua:</label>
                          <input
                              type="password"
                              class="form-control"
                              id="old_password"
                              name="old_password" 
                              autocomplete="current-password"
                              autofocus
                              value=""
                          />
                      </div>
                      {% if formPassword.errors %}
                          <div class="bg-primary text-white p-3 mb-4">
                              <ul>
                                  {% for error in formPassword.old_password.errors %}
                                      <li>{{ error }}</li>
                                  {% endfor %}
                              </ul>
                          </div>
                      {% endif %}
                      <div class="form-group">
                          <label for="new_password1">Contraseña nueva:</label>
                          <input
                              type="password"
                              class="form-control"
                              id="new_password1"
                              name="new_password1"  
                          />
                      </div>
                      <div class="form-group">
                          <label for="new_password2">Confirmar contraseña nueva:</label>
                          <input
                              type="password"
                              class="form-control"
                              id="new_password2"
                              name="new_password2" 
                          />
                      </div>
                      <div class="mt-5 text-center"><button class="btn btn-primary profile-button" type="submit">Actualizar Contraseña</button></div>
                  </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer Start -->
   <div class="container-fluid pt-4 px-4">
    <div class="bg-secondary rounded-top p-4">
      <div class="row">
        <div class="col-12 col-sm-6 text-center text-sm-start">
          &copy; <a href="#">MAPAGA</a>, All Right Reserved.
        </div>
        <div class="col-12 col-sm-6 text-center text-sm-end">
          <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
          Designed By <a href="#">Marco Sevilla</a>
          <br />Distributed By:
          <a href="#" target="_blank">Universidad de Salamanca</a>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer End -->
  
</div>
{% endblock content %}